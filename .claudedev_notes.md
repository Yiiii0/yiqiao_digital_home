# Claude Dev Project Notes - Yiqiao's Personal Website

**⚠️ IMPORTANT: This file is for development reference only. DO NOT commit to GitHub.**

## Project Overview

这是 Yiqiao Zhou 的个人网站，使用 Astro 框架构建，部署在 GitHub Pages。

- **技术栈**: Astro, TypeScript, Tailwind CSS
- **部署**: GitHub Pages (静态网站)
- **特点**: 完全静态，无需服务器端运行时

## Project Structure

```
yiqiao.github.io/
├── src/
│   ├── components/          # Astro 组件
│   │   ├── Header.astro     # 导航栏（含语言切换器）
│   │   ├── Hero.astro       # 首页 Hero 区域
│   │   ├── About.astro      # About Me 区域
│   │   ├── Rambling.astro   # Rambling 博客/片段区域
│   │   ├── Experience.astro # 工作经历
│   │   ├── Research.astro   # 研究 & 助教经历
│   │   ├── Education.astro  # 教育经历
│   │   └── Footer.astro     # 页脚
│   ├── pages/
│   │   └── index.astro      # 主页
│   ├── config.ts            # 网站配置（个人信息、经历等，支持双语）
│   ├── data/
│   │   └── rambling.json    # Rambling 内容（snippets 和 blogs 元数据）
│   ├── content/
│   │   └── blogs/           # Blog markdown 文件目录
│   │       ├── ai-startup-moat.md    # 示例博客
│   │       └── README.md             # Blog 使用说明
│   ├── i18n/                # 国际化相关
│   │   ├── translations.ts  # 翻译文件（中英文）
│   │   └── i18n.js          # i18n 工具函数
│   └── utils/
│       └── i18n-helpers.ts  # i18n 辅助函数
├── scripts/
│   ├── add-rambling.js      # 添加 rambling 的脚本
│   └── add-rambling-and-push.sh  # 添加并推送的脚本
└── .claudedev_notes.md      # 本文件（开发笔记）
```

## Key Features Implemented

### 1. 中英文双语支持 (2025-10-02)

**实现方式:**
- Header 右侧添加语言切换按钮（EN / 中文）
- 语言选择保存在 `localStorage`
- 所有静态文本通过 `data-i18n` 属性标记
- 动态内容（经历、教育等）的数据结构改为对象：`{ en: "...", zh: "..." }`

**已支持双语的内容:**
- ✅ 导航菜单
- ✅ Hero 标题
- ✅ About Me 内容
- ✅ Work Experience
- ✅ Research & TA
- ✅ Education
- ✅ Rambling snippets 和 blog 标题/摘要

**翻译原则:**
- 专业术语保留英文（如 AI、LLM、Machine Learning、OCR 等）
- 公司名、项目名保留英文
- 描述性内容提供自然的中文翻译

**相关文件:**
- `src/i18n/translations.ts` - 静态文本翻译
- `src/config.ts` - 个人信息双语数据
- `src/data/rambling.json` - Rambling 内容双语数据
- 所有组件的 `<script>` 部分 - 语言切换逻辑

### 2. Rambling 系统 (2025-10-02)

**两种内容类型:**

#### Snippet (片段)
- 一两句话的简短想法
- 直接在列表中显示完整内容
- 数据结构:
  ```json
  {
    "type": "snippet",
    "date": "YYYY-MM-DD",
    "content": { "en": "...", "zh": "..." },
    "tag": "AI" | "personal" | "tech" | "work"
  }
  ```

#### Blog (博客)
- 较长的文章（1-3 段或更多）
- 列表中显示标题 + 摘要
- 点击"Read more"打开模态框查看完整内容
- Markdown 文件存储在 `src/content/blogs/`
- 数据结构:
  ```json
  {
    "type": "blog",
    "date": "YYYY-MM-DD",
    "title": { "en": "...", "zh": "..." },
    "summary": { "en": "...", "zh": "..." },
    "file": "filename.md",
    "tag": "AI" | "personal" | "tech" | "work"
  }
  ```

**筛选功能:**
- Type 筛选: All Types / Snippets / Blogs
- Tag 筛选: All Tags / AI / personal / tech / work
- 两个筛选器可以联合使用

**添加新内容:**
```bash
# 添加 snippet
node scripts/add-rambling.js snippet "内容" "tag" [date]

# 添加 blog (需要先创建 markdown 文件)
# 1. 在 src/content/blogs/ 创建 your-blog.md
# 2. 运行:
node scripts/add-rambling.js blog "标题" "摘要" "your-blog.md" "tag" [date]
```

## Data Structure Patterns

### 双语字段模式
```typescript
// 简单文本
{
  field: {
    en: "English text",
    zh: "中文文本"
  }
}

// 数组
{
  items: {
    en: ["Item 1", "Item 2"],
    zh: ["项目 1", "项目 2"]
  }
}
```

### 获取双语值的辅助函数
```typescript
function getEN(value: any): any {
  if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
    return value.en || '';
  }
  return value || '';
}
```

## Important Notes

### GitHub Pages 部署限制
- ⚠️ 只能使用纯静态技术
- ✅ 可用: HTML, CSS, JavaScript, Astro (静态生成)
- ❌ 不可用: 需要服务器的技术（Node.js runtime, API routes等）
- ✅ Markdown 文件在构建时读取并转换为静态 HTML

### 配置文件说明

#### `src/config.ts`
包含所有个人信息和网站内容。修改此文件更新:
- 个人简介 (`aboutMe`)
- 工作经历 (`experience`)
- 研究经历 (`research`)
- 教育背景 (`education`)
- 技能标签 (`skills`, `keywords`)

**注意:** 所有文本字段现在都是双语对象。

#### `src/data/rambling.json`
Rambling 内容的元数据。Blog 的完整内容存储在 markdown 文件中。

### Markdown 支持的语法

当前 Rambling.astro 中的简单 markdown 解析器支持:
- 标题 (`#`, `##`, `###`)
- 加粗 (`**text**`)
- 列表 (`- item`)
- 链接 (`[text](url)`)
- 段落分隔

如需更多 markdown 特性，修改 `Rambling.astro` 中的 `markdownToHtml` 函数。

## Common Tasks

### 更新个人信息
编辑 `src/config.ts`，记得同时更新中英文。

### 添加新的工作经历
在 `src/config.ts` 的 `experience` 数组中添加新对象，格式:
```typescript
{
  company: "Company Name",
  title: {
    en: "Job Title (English)",
    zh: "职位名称（中文）"
  },
  dateRange: "Month YYYY - Month YYYY",
  bullets: {
    en: ["Achievement 1", "Achievement 2"],
    zh: ["成就 1", "成就 2"]
  }
}
```

### 添加新的 Rambling
参见上文"Rambling 系统"部分。

### 添加新的翻译
编辑 `src/i18n/translations.ts`。

## Development Commands

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 构建生产版本
npm run build

# 预览构建结果
npm run preview
```

## Git Workflow

```bash
# 常规提交
git add .
git commit -m "Your message"
git push

# 注意: .claudedev_notes.md 已在 .gitignore 中，不会被提交
```

## Design Principles

1. **简洁优雅**: 使用简洁的设计和动画
2. **响应式**: 所有组件都支持移动端
3. **性能优先**: 静态生成，加载速度快
4. **可维护性**: 配置驱动，易于更新内容
5. **双语支持**: 保留专业术语英文，提供自然中文翻译

## Recent Updates (2025-10-20)

### Bug Fixes & Improvements

#### 1. Fixed Default Language (English)
**Problem:** Website defaulted to Chinese on first visit due to localStorage handling
**Solution:**
- Updated `src/i18n/i18n.js` to explicitly set 'en' on first visit
- Updated `src/components/Header.astro` for consistent language initialization
- Added URL parameter support (`?lang=en` or `?lang=zh`) for easy testing and language override

#### 2. Fixed Infinite Recursion Bug
**Problem:** `Maximum call stack size exceeded` error in i18n.js
**Root Cause:** Circular event triggering - `updatePage()` triggered `languageChange` event, which called `updatePage()` again
**Solution:** Refactored event flow to prevent circular triggering:
```javascript
// updatePage() now only updates DOM, doesn't dispatch events
// languageChange listener updates state and DOM without retriggering
```

#### 3. Fixed Markdown Rendering Issues
**Problem:** Markdown headings (h1, h2, h3) not displaying with proper styling
**Root Causes:**
- Race condition: marked.js CDN loading vs script execution timing
- Tailwind CSS Preflight resets all default HTML styles
- Astro scoped styles preventing global CSS application

**Solutions:**
- Added `setTimeout` to wait for marked.js to load
- Created comprehensive fallback markdown renderer for CDN failures
- **Critical Fix:** Changed `<style>` to `<style is:global>` in Rambling.astro
- Added `!important` to all markdown CSS rules to override Tailwind Preflight
- Added error handling and loading state for markdown content
- Added debug console logging for troubleshooting

#### 4. Code Quality Improvements
- Removed duplicate `getLocalizedValue` function
- Consolidated markdown rendering logic
- Added comprehensive error handling with fallback
- Added debug logging for language and markdown rendering

**Modified Files:**
- `src/i18n/i18n.js` - Language initialization and event handling
- `src/components/Header.astro` - Language switcher logic
- `src/components/Rambling.astro` - Markdown rendering and CSS styles

## Recent Updates (2025-11-12)

### Custom Domain Configuration Fix

**Problem:** After switching to custom domain `yiqiaoz.me`, all CSS/JS styles were broken (404 errors).

**Root Cause:** The `astro.config.mjs` still had old GitHub Pages project page configuration:
- `site: 'https://yiiii0.github.io'` (old domain)
- `base: '/yiqiao_digital_home'` (project page path)

This caused all asset URLs to be prefixed with `/yiqiao_digital_home/`, resulting in 404s on the root domain.

**Solution:**
1. Updated `astro.config.mjs`:
   - Changed `site` to `'https://yiqiaoz.me'`
   - Removed `base` configuration (defaults to `/` for user pages)
2. Created `public/CNAME` file with content `yiqiaoz.me`

**Key Learnings:**
- **Project Pages** (repo pages) need `base: '/repo-name/'`
- **User Pages** (custom domain) should NOT have `base` or use `base: '/'`
- CNAME file must be in `public/` directory for Astro (gets copied to build output)

**Modified Files:**
- `astro.config.mjs` - Updated site URL and removed base path
- `public/CNAME` - Created for GitHub Pages custom domain

## Future Enhancements (Potential)

- [ ] 优化移动端语言切换器显示
- [ ] 添加深色模式支持
- [ ] 添加 RSS feed for blogs
- [ ] 添加搜索功能
- [ ] 考虑移除调试console.log（生产环境）

## Troubleshooting

### 构建失败
- 检查 `src/config.ts` 中的数据结构是否正确
- 确保所有双语字段都有 `en` 和 `zh` 属性
- 检查 Blog markdown 文件是否存在

### 语言切换不工作
- 检查浏览器控制台是否有错误
- 确认 `src/i18n/i18n.js` 已被正确导入
- 检查 localStorage 是否被禁用

### Rambling blog 显示问题
- 确认 markdown 文件路径正确
- 检查 `rambling.json` 中的 `file` 字段
- 确认 markdown 内容格式正确

---

**Last Updated**: 2025-11-12
**Maintained by**: Claude (Anthropic AI Assistant)
